# .github/workflows/build-mipsel-latest.yml
name: ğŸš€ Build qbittorrent-nox for JDCloud RE-SP-01B (mipsel) - LATEST VERSIONS

on:
  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
    # ä¸éœ€è¦ä»»ä½•è¾“å…¥å‚æ•°ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨é€‰æ‹©æœ€æ–°ç‰ˆæœ¬
    inputs: {}

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # 1. æ£€å‡ºä½  Fork çš„ä»“åº“ä»£ç 
      - name: ğŸ” Checkout Repository
        uses: actions/checkout@v4

      # 2. èµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™
      - name: âš™ï¸ Grant execute permission
        run: chmod +x qbittorrent-nox-static.sh

      # 3. æ ¸å¿ƒç¼–è¯‘æ­¥éª¤
      #    -ma mipsel: æŒ‡å®šç›®æ ‡æ¶æ„ä¸º mipsel (JDCloud è·¯ç”±å™¨)
      #    ä¸ä¼ é€’ -lt æˆ– -qt å‚æ•°ï¼Œè®©è„šæœ¬è‡ªåŠ¨é€‰æ‹©æœ€æ–°ç¨³å®šç‰ˆ
      - name: ğŸ› ï¸ Compile qbittorrent-nox-static for mipsel (Latest Versions)
        run: |
          # è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œè·³è¿‡ ICU ä»¥å‡å°æœ€ç»ˆæ–‡ä»¶ä½“ç§¯ï¼ˆå¯é€‰ï¼‰
          export qbt_skip_icu="yes"
          # å¼€å§‹ç¼–è¯‘
          ./qbittorrent-nox-static.sh all -ma mipsel

      # 4. ä¸Šä¼ ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶
      - name: ğŸ“¤ Upload Artifact (qbittorrent-nox binary)
        uses: actions/upload-artifact@v4
        with:
          name: qbittorrent-nox-mipsel-latest
          path: qbt-build/completed/qbittorrent-nox
          retention-days: 5 # ä¿ç•™5å¤©

      # 5. (å¯é€‰) ä¸Šä¼ å®Œæ•´æ—¥å¿—ç”¨äºè°ƒè¯•
      - name: ğŸ“‹ Upload Full Build Logs (Debug)
        if: failure() # ä»…åœ¨ç¼–è¯‘å¤±è´¥æ—¶ä¸Šä¼ 
        uses: actions/upload-artifact@v4
        with:
          name: full-build-logs-mipsel
          path: qbt-build/logs/
          retention-days: 2
