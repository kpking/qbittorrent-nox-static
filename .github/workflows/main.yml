# .github/workflows/build-mipsel-latest.yml
name: 🚀 Build qbittorrent-nox for JDCloud RE-SP-01B (mipsel) - LATEST VERSIONS

on:
  # 允许手动触发
  workflow_dispatch:
    # 不需要任何输入参数，脚本会自动选择最新版本
    inputs: {}

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # 1. 检出你 Fork 的仓库代码
      - name: 🔍 Checkout Repository
        uses: actions/checkout@v4

      # 2. 赋予脚本执行权限
      - name: ⚙️ Grant execute permission
        run: chmod +x qbittorrent-nox-static.sh

      # 3. 核心编译步骤
      #    -ma mipsel: 指定目标架构为 mipsel (JDCloud 路由器)
      #    不传递 -lt 或 -qt 参数，让脚本自动选择最新稳定版
      - name: 🛠️ Compile qbittorrent-nox-static for mipsel (Latest Versions)
        run: |
          # 设置环境变量，跳过 ICU 以减小最终文件体积（可选）
          export qbt_skip_icu="yes"
          # 开始编译
          ./qbittorrent-nox-static.sh all -ma mipsel

      # 4. 上传编译好的二进制文件
      - name: 📤 Upload Artifact (qbittorrent-nox binary)
        uses: actions/upload-artifact@v4
        with:
          name: qbittorrent-nox-mipsel-latest
          path: qbt-build/completed/qbittorrent-nox
          retention-days: 5 # 保留5天

      # 5. (可选) 上传完整日志用于调试
      - name: 📋 Upload Full Build Logs (Debug)
        if: failure() # 仅在编译失败时上传
        uses: actions/upload-artifact@v4
        with:
          name: full-build-logs-mipsel
          path: qbt-build/logs/
          retention-days: 2
