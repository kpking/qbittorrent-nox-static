# .github/workflows/build-mipsel.yml
name: Build qbittorrent-nox for JDCloud RE-SP-01B (mipsel)

on:
  # 手动触发编译
  workflow_dispatch:
    inputs:
      libtorrent_version:
        description: 'Libtorrent version (1.2 or 2.0)'
        required: true
        default: '2.0'
      qbittorrent_tag:
        description: 'qBittorrent tag (e.g., release-4.6.4, v4.6.4)'
        required: false
        default: ''

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # 1. 检出代码
      - name: Checkout Repository
        uses: actions/checkout@v4

      # 2. 设置权限 (可选，但推荐)
      - name: Grant execute permission
        run: chmod +x qbittorrent-nox-static.sh

      # 3. 核心编译步骤
      #    使用 -ma mipsel 参数指定目标架构
      #    使用 -lt 参数指定 libtorrent 版本 (1.2 或 2.0)
      #    使用 -qt 参数指定 qBittorrent 版本 (可选)
      - name: Compile qbittorrent-nox-static for mipsel
        run: |
          ./qbittorrent-nox-static.sh all -ma mipsel \
            -lt "v${{ inputs.libtorrent_version }}.x" \
            ${{ inputs.qbittorrent_tag && format('-qt {0}', inputs.qbittorrent_tag) || '' }}

      # 4. 上传编译好的二进制文件作为 Artifact
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: qbittorrent-nox-mipsel
          path: qbt-build/completed/qbittorrent-nox
          retention-days: 5 # 保留5天，足够你下载

      # 5. (可选) 上传整个构建目录用于调试
      # - name: Upload Full Build Directory (Debug)
      #   uses: actions/upload-artifact@v4
      #   with:
      #     name: full-build-dir-mipsel
      #     path: qbt-build/
      #     retention-days: 2
